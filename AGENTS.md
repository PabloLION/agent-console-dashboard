# Agent Instructions

This project uses **bd** (beads) for issue tracking. Run `bd onboard` to get
started.

## Quick Reference

```bash
bd ready              # Find available work
bd show <id>          # View issue details
bd update <id> --status in_progress  # Claim work
bd close <id>         # Complete work
bd sync               # Sync with git
```

## Development Scripts

@scripts/README.md

## Development Standards

### Rust

- Run `./scripts/fmt.sh` before committing (or `cargo fmt --all`)
- Run `./scripts/lint.sh` to check formatting + clippy
- Run `./scripts/test.sh` to verify all tests pass
- Use `expect("message")` over `unwrap()` — never use bare `unwrap()`
- Pre-commit hooks run formatting, clippy, and tests automatically

### Testing

- Tests that manipulate environment variables must use `#[serial]` from the
  `serial_test` crate
- Use `tempfile::tempdir()` for tests that need filesystem isolation
- Test rendering with `ratatui::backend::TestBackend` — see `tui/test_utils.rs`
  for helpers

### Architecture

- Cargo workspace with main crate `agent-console-dashboard` (binary: `acd`)
- Daemon communicates with TUI via Unix domain socket (JSON Lines protocol)
- Configuration: TOML at `$XDG_CONFIG_HOME/agent-console-dashboard/config.toml`
- Hook system: Claude Code plugin (`.claude-plugin/` generated by build.rs)

## Landing the Plane (Session Completion)

**When ending a work session**, you MUST complete ALL steps below. Work is NOT
complete until `git push` succeeds.

**MANDATORY WORKFLOW:**

1. **File issues for remaining work** - Create issues for anything that needs
   follow-up
2. **Run quality gates** (if code changed) - Tests, linters, builds
3. **Update issue status** - Close finished work, update in-progress items
4. **PUSH TO REMOTE** - This is MANDATORY:

   ```bash
   git pull --rebase
   bd sync
   git push
   git status  # MUST show "up to date with origin"
   ```

5. **Clean up** - Clear stashes, prune remote branches
6. **Verify** - All changes committed AND pushed
7. **Hand off** - Provide context for next session

**CRITICAL RULES:**

- Work is NOT complete until `git push` succeeds
- NEVER stop before pushing - that leaves work stranded locally
- NEVER say "ready to push when you are" - YOU must push
- If push fails, resolve and retry until it succeeds

## Naming Conventions

### Layout Modes

Call the current full TUI view **"large layout"** for now. A naming refactor is
tracked in acd-zcjx — do not bikeshed names until that issue is addressed.

### API Usage Widget Modes

Two modes only (renamed):

- **short** (was "compact"): `[5h:8% 7d:77%]`
- **long** (was "full", redefined): time elapsed + quota (see acd-elrc)

The old "full" mode is dropped.

## Decision Documentation

Project-specific design decisions must have a counterpart in `docs/decisions/`.
Agent memories are working notes — do not store decisions only in memory.

When you make a design choice (choosing X over Y for reason Z), check
`docs/decisions/INDEX.md`. If no matching doc exists, create one. Keep it
concise: state the decision, alternatives considered, and rationale.

A biweekly memory audit (each minor version bump) verifies all agent memories
are in sync with `docs/decisions/`. See `docs/dev/release-checklist.md`.

## Terminology

@docs/terminology.md
