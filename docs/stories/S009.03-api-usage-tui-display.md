# Story: Display Usage in TUI

**Story ID:** S009.03 **Epic:**
[E009 - API Usage Tracking](../epic/E009-api-usage-tracking.md) **Status:**
Draft **Priority:** P1 **Estimated Points:** 2

## Description

As a user, I want to see my API quota utilization in the TUI dashboard, So that
I can pace my usage and avoid hitting rate limits.

## Context

With the `claude-usage` crate integrated (S009.01), the TUI has access to
account-level 5h and 7d utilization data. This story renders that data in a
compact format in the dashboard. The display shows utilization percentages and
time until rate limit reset.

## Implementation Details

### Technical Approach

1. Read usage data from TUI state (populated by S009.01)
2. Render quota percentages in dashboard footer or status bar
3. Support both full and compact display formats based on terminal width
4. Show "unavailable" placeholder when data is missing
5. Apply color coding for utilization levels

### Display Format

Full:

```text
Quota: 5h 8% | 7d 77% | resets 2h 15m
```

Compact:

```text
[5h:8% 7d:77%]
```

### Files to Modify

- `crates/agent-console-dashboard/src/tui/views/dashboard.rs` (new) — render
  usage in dashboard
- `crates/agent-console-dashboard/src/widgets/api_usage.rs` (new) — usage
  display widget

### Dependencies

- [S009.01 - Integrate claude-usage Crate](./S009.01-api-usage-data-model.md) —
  provides usage data in TUI state
- [S004.01 - Ratatui Application Scaffold](./S004.01-ratatui-application-scaffold.md)
  — TUI application base
- [S005.01 - Widget Trait Interface](./S005.01-widget-trait-interface.md) —
  widget rendering pattern

## Acceptance Criteria

- [ ] Given usage data is available, when the dashboard renders, then 5h and 7d
      utilization percentages are displayed
- [ ] Given usage data is unavailable, when the dashboard renders, then
      "Quota: --" placeholder is shown
- [ ] Given terminal width is narrow, when rendering, then compact format is used
- [ ] Given 5h utilization exceeds 80%, when displayed, then yellow color is
      applied
- [ ] Given 5h utilization exceeds 95%, when displayed, then red color is applied
- [ ] Given rate limit reset time is available, when displayed, then remaining
      time is shown
- [ ] Given the TUI is running, when usage data refreshes, then display updates
      on next render cycle

## Testing Requirements

- [ ] Unit test: Full format renders correct string for sample data
- [ ] Unit test: Compact format renders correct string
- [ ] Unit test: Unavailable state shows placeholder
- [ ] Unit test: Color thresholds apply correctly
- [ ] Unit test: Reset time formatting produces human-readable output

## Out of Scope

- Per-session token tracking display
- Usage graphs or charts over time
- Cost estimates or billing information
- Usage alerts or notifications
- Export or copy usage data

## Notes

### Color Thresholds

| Utilization | Color  |
| ----------- | ------ |
| < 50%       | Green  |
| 50% - 80%   | Yellow |
| > 80%       | Red    |

### Formatting Helpers

```rust
/// Format utilization percentage for display
fn format_utilization(pct: f64) -> String {
    format!("{:.0}%", pct * 100.0)
}

/// Format reset time as human-readable duration
fn format_reset_time(reset: DateTime<Utc>) -> String {
    let duration = reset - Utc::now();
    let hours = duration.num_hours();
    let minutes = duration.num_minutes() % 60;
    if hours > 0 {
        format!("{}h {}m", hours, minutes)
    } else {
        format!("{}m", minutes)
    }
}
```

### Graceful Degradation

When usage data is unavailable:

- Display "Quota: --" placeholder
- Log a debug message but don't show errors to user
- Continue normal operation with other widgets
