# Story: Invoke claude --resume in Terminal/Pane

**Story ID:** S010.03 **Epic:**
[E010 - Zellij Integration](../epic/E010-zellij-integration.md) **Status:**
Draft **Priority:** P2 **Estimated Points:** 5

## Description

As a user, I want to invoke `claude --resume <session-id>` in a Zellij pane or
plain terminal, So that I can resume a closed Claude Code session from the
dashboard or CLI without manually typing the command.

## Context

This story was moved from E008 (S008.03) to E010 because the actual execution of
`claude --resume` in a terminal/pane is a Zellij integration concern, not a
protocol concern. E008 provides the RESURRECT IPC command and session metadata;
this story handles the terminal-side execution.

The implementation detects the terminal environment (Zellij, tmux, plain
terminal), creates a new pane if in Zellij, or falls back to running the command
in the current terminal.

## Implementation Details

### Technical Approach

1. Detect terminal environment via environment variables (`ZELLIJ`, `TMUX`)
2. Implement Zellij pane creation using `zellij action new-pane`
3. Implement fallback: print the `claude --resume` command for manual execution
4. Handle working directory context (cd to session's working dir before resume)
5. Report errors when Zellij CLI is unavailable or pane creation fails

### Files to Create

- `crates/agent-console-dashboard/src/integrations/zellij.rs` — Zellij CLI
  wrapper (environment detection, pane creation)

### Files to Modify

- `crates/agent-console-dashboard/src/main.rs` — add resurrect subcommand
  integration with terminal execution

### Dependencies

- [S008.01 - Closed Session Metadata](./S008.01-closed-session-metadata.md) —
  provides session data for resurrection
- [S008.02 - RESURRECT Command](./S008.02-resurrect-command.md) — IPC command
  that triggers resurrection
- [S010.01 - Zellij Layout Dashboard](./S010.01-zellij-layout-dashboard.md) —
  base Zellij integration

## Acceptance Criteria

- [ ] `claude --resume` invoked in new Zellij pane when running inside Zellij
- [ ] Falls back to current terminal when not in Zellij
- [ ] Working directory set to session's original working directory
- [ ] Error message displayed when Zellij pane creation fails
- [ ] Command printed to stdout when `--no-execute` flag is used
- [ ] `cargo test --workspace` passes
- [ ] `cargo clippy --workspace` passes

## Testing Requirements

- [ ] Unit test: environment detection identifies Zellij via `ZELLIJ` env var
- [ ] Unit test: environment detection identifies plain terminal
- [ ] Unit test: resume command string generation is correct
- [ ] Manual test: resurrection creates new Zellij pane
- [ ] Manual test: resurrection works in plain terminal (fallback)

## Out of Scope

- tmux integration (future enhancement)
- Clipboard copy of resume command
- Automatic pane selection or positioning
- Native Zellij WASM plugin integration

## Notes

### Environment Detection

```rust
pub fn is_zellij() -> bool {
    std::env::var("ZELLIJ").is_ok()
}

pub fn is_tmux() -> bool {
    std::env::var("TMUX").is_ok()
}
```

### Zellij Pane Creation

```bash
zellij action new-pane -- claude --resume <session-id>
```
