# Story: Define Session Data Model

**Story ID:** S2.1 **Epic:**
[E002 - Session Management](../epic/E002-session-management.md) **Status:**
Draft **Priority:** P1 **Estimated Points:** 3

## Description

As a developer, I want to define a comprehensive session data model, So that I
can represent all necessary session information for tracking and displaying
agent sessions.

## Context

The session data model is the foundation of the Agent Console Dashboard's
session management capabilities. It needs to capture all information required to
track, display, and resurrect agent sessions. The model must support multiple
agent types (starting with Claude Code) and maintain enough state for real-time
monitoring.

This story follows S1.3 (in-memory session store) and provides the domain types
that the store will manage.

Key design decisions from architecture:

- State is ephemeral (not persisted across reboots)
- Model supports future agent types via AgentType enum
- Session ID for Claude Code is stored separately for resurrection feature
- API usage is optional since not all hooks provide this data

## Implementation Details

### Technical Approach

1. Define the core `Session` struct with all required fields
2. Define the `Status` enum with all possible states
3. Define the `AgentType` enum for extensibility
4. Define the `StateTransition` struct for history tracking
5. Define the `ApiUsage` struct for token tracking
6. Implement `Default` traits where appropriate
7. Implement serialization with serde for JSON output

### Files to Modify

- `src/daemon/session.rs` (new) - Session data model types
- `src/daemon/mod.rs` - Re-export session types
- `src/lib.rs` - Shared types if needed for client

### Dependencies

- [S1.3 - In-Memory Session Store](./S1.3-in-memory-session-store.md) - Store
  must exist before defining what it stores

## Acceptance Criteria

- [ ] Given the Session struct, then it contains: id, agent_type, status,
      working_dir, since, history, api_usage, closed, session_id
- [ ] Given the Status enum, then it contains: Working, Attention, Question,
      Closed variants
- [ ] Given the AgentType enum, then it contains: ClaudeCode variant with
      extensibility comment for future agents
- [ ] Given the StateTransition struct, then it contains: timestamp, from, to,
      duration fields
- [ ] Given the ApiUsage struct, then it contains: input_tokens, output_tokens
      fields
- [ ] Given a Session instance, then it can be serialized to JSON for IPC
      responses
- [ ] Given a new session, then default values are sensible (empty history, None
      api_usage, false closed)

## Testing Requirements

- [ ] Unit test: Session can be created with all required fields
- [ ] Unit test: Session serializes to valid JSON
- [ ] Unit test: Session deserializes from valid JSON
- [ ] Unit test: Status enum serializes as expected strings ("working",
      "attention", etc.)
- [ ] Unit test: Default implementations produce expected values

## Out of Scope

- Status transition validation logic (S2.2)
- State history recording logic (S2.3)
- Lifecycle event handling (S2.4)
- API usage update logic (E009)

## Notes

### Data Model Reference

```rust
/// Session state with history
struct Session {
    id: String,
    agent_type: AgentType,       // ClaudeCode, Future agents
    status: Status,
    working_dir: PathBuf,
    since: Instant,              // When status last changed
    history: Vec<StateTransition>,
    api_usage: Option<ApiUsage>,
    closed: bool,                // For resurrection feature
    session_id: Option<String>,  // Claude Code session ID for resume
}

enum Status {
    Working,
    Attention,
    Question,
    Closed,
}

enum AgentType {
    ClaudeCode,
    // Future: Other agents
}

struct StateTransition {
    timestamp: Instant,
    from: Status,
    to: Status,
    duration: Duration,
}

struct ApiUsage {
    input_tokens: u64,
    output_tokens: u64,
    // Extend as needed
}
```

### Serialization Considerations

- `Instant` and `Duration` need custom serialization (convert to Unix
  timestamps/milliseconds)
- `PathBuf` serializes as string path
- Status enum should serialize as lowercase strings for IPC protocol consistency

### Key Dependencies

| Crate      | Purpose                     |
| ---------- | --------------------------- |
| serde      | Serialization derive macros |
| serde_json | JSON serialization          |
