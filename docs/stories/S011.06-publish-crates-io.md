# Story: Publish to crates.io

**Story ID:** S011.06 **Epic:**
[E011 - Claude Usage Crate](../epic/E011-claude-usage-crate.md) **Status:** Draft
**Priority:** P0 **Estimated Points:** 1

## Description

As a crate author, I want to publish `claude-usage` to crates.io, So that other Rust developers can use it as a dependency and the `claude-usage` name is registered.

## Context

Publishing to crates.io makes the crate available to the Rust ecosystem. This story covers preparing metadata, documentation, and executing the publish process. Name registration is a key goal: securing the `claude-usage` name prevents squatting and establishes ownership.

## Implementation Details

### Technical Approach

1. Complete Cargo.toml metadata (description, keywords, categories, etc.)
2. Create README.md for the crate (shown on crates.io)
3. Add LICENSE files (MIT + Apache-2.0 dual license)
4. Verify package contents with `cargo package --list`
5. Dry run with `cargo publish --dry-run`
6. Publish with `cargo publish`

### Crate Metadata

```toml
[package]
name = "claude-usage"
version = "0.1.0"
edition = "2021"
rust-version = "1.74"
description = "Fetch Claude API usage data from Anthropic OAuth endpoint"
license = "MIT OR Apache-2.0"
repository = "https://github.com/PabloLION/agent-console-dashboard"
homepage = "https://github.com/PabloLION/agent-console-dashboard"
documentation = "https://docs.rs/claude-usage"
readme = "README.md"
keywords = ["claude", "anthropic", "usage", "api", "oauth"]
categories = ["api-bindings", "authentication"]
```

### Files to Create

- `crates/claude-usage/README.md` - Crate documentation
- `crates/claude-usage/LICENSE-MIT` - MIT license
- `crates/claude-usage/LICENSE-APACHE` - Apache 2.0 license

### Files to Modify

- `crates/claude-usage/Cargo.toml` - Complete metadata

### Dependencies

- S011.05: Typed usage response must be implemented (crate must be functional)

## Acceptance Criteria

- [ ] Given complete metadata, when `cargo publish --dry-run` runs, then no errors reported
- [ ] Given valid crates.io token, when `cargo publish` runs, then crate is published successfully
- [ ] Given published crate, when searched on crates.io, then `claude-usage` appears
- [ ] Given published crate, when docs.rs builds, then documentation is available at docs.rs/claude-usage
- [ ] Given another project, when `cargo add claude-usage` runs, then crate can be installed

## Testing Requirements

- [ ] `cargo publish --dry-run` succeeds
- [ ] `cargo package --list` shows expected files (no extra cruft)
- [ ] All public items have documentation comments
- [ ] README examples are valid Rust code
- [ ] `cargo doc --no-deps` builds documentation without errors

## Out of Scope

- CI/CD automation for publishing (future)
- Changelog automation
- Version bumping automation
- npm publishing (handled in S011.07, deferred)

## Notes

### Pre-Publish Checklist

1. [ ] All tests pass: `cargo test --workspace`
2. [ ] Clippy clean: `cargo clippy --workspace -- -D warnings`
3. [ ] Docs build: `cargo doc --no-deps`
4. [ ] Dry run succeeds: `cargo publish --dry-run`
5. [ ] Version is 0.1.0 (initial release)
6. [ ] LICENSE files present
7. [ ] README is accurate and complete
8. [ ] All public items documented

### Publishing Command

```bash
cd crates/claude-usage
cargo publish
```

### Post-Publish Verification

1. Check [crates.io/crates/claude-usage](https://crates.io/crates/claude-usage)
2. Check [docs.rs/claude-usage](https://docs.rs/claude-usage) (may take a few minutes to build)
3. Test installation: `cargo init test-project && cd test-project && cargo add claude-usage`
4. Verify usage example compiles

### README Content (Summary)

The README should include:

- **Title and description**: "Fetch Claude API usage data from Anthropic"
- **Features**: Cross-platform credential fetch, typed response, simple API
- **Usage example**: Full example showing `get_usage()` call
- **Platform support**: macOS (Keychain), Linux (file)
- **Requirements**: Claude Code must be installed and logged in
- **License**: MIT OR Apache-2.0

### Version Strategy

- **v0.1.0**: Initial release with macOS and Linux support
- **v0.2.x**: Future enhancements (async, Windows support, napi-rs bindings)
- **v1.0.0**: Stable API after real-world usage
