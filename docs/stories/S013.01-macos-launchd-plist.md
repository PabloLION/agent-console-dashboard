# Story: Create macOS launchd Plist

**Story ID:** S013.01 **Epic:**
[E013 - Deployment Infrastructure](../epic/E013-deployment-infrastructure.md)
**Status:** Draft **Priority:** P1 **Estimated Points:** 2

## Description

As a macOS user, I want a launchd plist file that runs the daemon as a
user-level service, So that the daemon starts automatically on login and
restarts on crash without manual intervention.

## Context

macOS uses launchd for service management. A plist file installed in
`~/Library/LaunchAgents/` runs as a user-level agent (no root required). The
daemon should start on login (`RunAtLoad`), restart on failure (`KeepAlive`),
and log output to a known location.

## Implementation Details

### Technical Approach

1. Create a launchd plist template with correct paths
2. Use `RunAtLoad` for automatic startup on login
3. Use `KeepAlive` for crash recovery
4. Route stderr to log file for diagnostics
5. Include the plist as a project resource

### Plist Template

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
  "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.agent-console.daemon</string>
    <key>ProgramArguments</key>
    <array>
        <string>/usr/local/bin/acd</string>
        <string>daemon</string>
    </array>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
    <key>StandardErrorPath</key>
    <string>/tmp/acd.log</string>
</dict>
</plist>
```

### Files to Create

- `resources/com.agent-console.daemon.plist` — launchd plist template

### Dependencies

- [E001 - Daemon Core Infrastructure](../epic/E001-daemon-core-infrastructure.md)
  — daemon binary must exist

## Acceptance Criteria

- [ ] Plist file is valid XML and passes `plutil -lint`
- [ ] `launchctl load` succeeds with the plist
- [ ] Daemon starts on login when plist is in `~/Library/LaunchAgents/`
- [ ] Daemon restarts automatically after crash
- [ ] Stderr routed to `/tmp/acd.log` (or configurable path)
- [ ] `launchctl unload` cleanly stops the service

## Testing Requirements

- [ ] Manual test: `plutil -lint` validates plist
- [ ] Manual test: `launchctl load` / `unload` cycle
- [ ] Manual test: kill daemon process, verify auto-restart
- [ ] Manual test: reboot/re-login, verify daemon starts

## Out of Scope

- CLI install/uninstall command (see S013.03)
- Dynamic path substitution in plist
- Log rotation configuration
