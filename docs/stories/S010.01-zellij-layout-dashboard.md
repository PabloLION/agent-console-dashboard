# Story: Create Zellij Layout with Dashboard Pane

**Story ID:** S010.01 **Epic:**
[E010 - Zellij Integration](../epic/E010-zellij-integration.md) **Status:**
Draft **Priority:** P1 **Estimated Points:** 3

## Description

As a user, I want a Zellij layout script that includes a dedicated dashboard
pane, So that I can have the Agent Console Dashboard always visible while
working on multiple Claude Code sessions.

## Context

Zellij is a terminal multiplexer that supports declarative layouts. The Agent
Console Dashboard should integrate seamlessly with Zellij workflows, allowing
users to have a persistent, always-visible dashboard pane that shows Claude Code
session status at a glance. This story creates the layout scripts and
documentation needed to embed the dashboard in Zellij layouts.

This is the primary integration point for Zellij users and enables the
multi-agent workflow experience where users can monitor several concurrent
Claude Code sessions.

## Implementation Details

### Technical Approach

1. Create a Zellij layout file (KDL format) with dashboard pane
2. Create a shell script (`zellij-claude-layout`) for easy layout startup
3. Support multiple pane size presets (1-line, 2-line, 3-line)
4. Document layout customization options
5. Provide installation instructions for user's Zellij config
6. Handle graceful startup when daemon is not running

### Files to Create

- `scripts/zellij-claude-layout.kdl` - Zellij layout definition file
- `scripts/zellij-claude-layout.sh` - Shell script to launch layout
- `docs/zellij-integration.md` - User documentation for Zellij setup

### Files to Modify

- `README.md` - Add Zellij integration section (optional)

### Dependencies

- [S004.01 - Ratatui Application Scaffold](./S004.01-ratatui-application-scaffold.md) -
  TUI must exist to display
- [S005.05 - Layout Presets](./S005.05-layout-presets.md) - Dashboard layout options
  (one-line, two-line)

## Acceptance Criteria

- [ ] Given a user runs `zellij-claude-layout`, then a Zellij session starts
      with dashboard pane visible
- [ ] Given the layout is loaded, then the dashboard pane appears at the top or
      bottom (configurable)
- [ ] Given a 1-line layout is requested, then dashboard pane height is
      minimized to show single line
- [ ] Given a 2-line or 3-line layout is requested, then dashboard pane height
      adjusts accordingly
- [ ] Given the daemon is not running, then the dashboard shows appropriate
      placeholder message
- [ ] Given the user closes the dashboard pane, then other panes continue
      functioning normally
- [ ] Given Zellij is not installed, then the script provides a helpful error
      message

## Testing Requirements

- [ ] Manual test: Layout loads correctly in Zellij with dashboard visible
- [ ] Manual test: Dashboard displays session data from daemon
- [ ] Manual test: 1-line, 2-line, and 3-line layouts work correctly
- [ ] Manual test: Pane can be resized without breaking dashboard
- [ ] Manual test: Script works on Linux and macOS
- [ ] Manual test: Appropriate error when Zellij not installed

## Out of Scope

- Native Zellij plugin (WASM-based)
- Automatic dashboard pane focus management
- Zellij session persistence across restarts
- Tmux or other multiplexer support

## Notes

### Zellij Layout File (KDL Format)

```kdl
// zellij-claude-layout.kdl
layout {
    // Dashboard pane at top - thin height
    pane size=3 {
        command "agent-console"
        args "tui" "--layout" "one-line"
    }

    // Main working area below
    pane
}
```

### Alternative Layout with Split

```kdl
// zellij-claude-layout-split.kdl
layout {
    // Dashboard pane at top
    pane size=3 {
        command "agent-console"
        args "tui" "--layout" "two-line"
    }

    // Split main area
    pane split_direction="vertical" {
        pane  // Left working pane
        pane  // Right working pane
    }
}
```

### Detailed Layout for Multi-Agent Workflow

```kdl
// zellij-claude-multi-agent.kdl
layout {
    // Dashboard pane at top - shows all sessions
    pane size=5 {
        command "agent-console"
        args "tui" "--layout" "detailed"
    }

    // Tab bar for multiple agents
    tab_bar

    // Three agent panes
    pane split_direction="horizontal" {
        pane name="agent-1"
        pane name="agent-2"
        pane name="agent-3"
    }
}
```

### Shell Script Wrapper

```bash
#!/bin/bash
# zellij-claude-layout.sh

# Check if Zellij is installed
if ! command -v zellij &> /dev/null; then
    echo "Error: Zellij is not installed. Please install it first."
    echo "See: https://zellij.dev/documentation/installation"
    exit 1
fi

# Get script directory for layout file path
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Default layout
LAYOUT="${1:-default}"

case "$LAYOUT" in
    "minimal"|"1-line")
        LAYOUT_FILE="$SCRIPT_DIR/zellij-claude-layout-minimal.kdl"
        ;;
    "default"|"2-line")
        LAYOUT_FILE="$SCRIPT_DIR/zellij-claude-layout.kdl"
        ;;
    "detailed"|"3-line")
        LAYOUT_FILE="$SCRIPT_DIR/zellij-claude-layout-detailed.kdl"
        ;;
    "multi")
        LAYOUT_FILE="$SCRIPT_DIR/zellij-claude-multi-agent.kdl"
        ;;
    *)
        echo "Unknown layout: $LAYOUT"
        echo "Available: minimal, default, detailed, multi"
        exit 1
        ;;
esac

# Check if layout file exists
if [ ! -f "$LAYOUT_FILE" ]; then
    echo "Error: Layout file not found: $LAYOUT_FILE"
    exit 1
fi

# Start Zellij with layout
zellij --layout "$LAYOUT_FILE"
```

### Pane Size Recommendations

| Dashboard Layout | Recommended Pane Size | Content                            |
| ---------------- | --------------------- | ---------------------------------- |
| one-line         | 1-2 rows              | Session names and status only      |
| two-line         | 2-3 rows              | Status + working directory         |
| detailed         | 4-6 rows              | Full status, directory, timestamps |
| history          | 6-8 rows              | Status + state history timeline    |

### Installation Instructions

Users should place the layout files in their Zellij config directory:

```bash
# Copy layouts to Zellij config
mkdir -p ~/.config/zellij/layouts
cp scripts/zellij-claude-*.kdl ~/.config/zellij/layouts/

# Or use directly
zellij --layout /path/to/zellij-claude-layout.kdl
```

### Detecting Zellij Environment

Scripts should detect if already running inside Zellij:

```bash
if [ -n "$ZELLIJ" ]; then
    echo "Already inside Zellij session"
    # Optionally: use zellij action new-pane instead
fi
```

### Auto-Start Daemon

Layout can optionally auto-start the daemon if not running:

```kdl
layout {
    // Start daemon in background (hidden pane)
    pane size=0 {
        command "agent-console"
        args "daemon" "--quiet"
    }

    // Dashboard pane
    pane size=3 {
        command "agent-console"
        args "tui" "--layout" "one-line"
    }

    // Main working area
    pane
}
```

### Future Considerations

- Support for named sessions (`zellij attach claude-workspace`)
- Layout persistence and restoration
- Integration with Zellij session manager
- Custom keybindings for dashboard interaction from other panes
