# Story: Create Zellij Layout with Dashboard Pane

**Story ID:** S010.01 **Epic:**
[E010 - Zellij Integration](../epic/E010-zellij-integration.md)
**Status:** Draft **Priority:** P1 **Estimated Points:** 3

## Description

As a Zellij user, I want a ready-to-use Zellij layout that includes a dedicated dashboard pane, So that I can monitor all Claude Code sessions at a glance while working in my terminal multiplexer.

## Context

Zellij supports declarative layouts via KDL files. This story creates the layout files and shell scripts needed to embed the Agent Console Dashboard in a Zellij pane. This provides the primary value of E010: persistent, always-visible session monitoring for Zellij users.

The layout integrates seamlessly with existing Zellij workflows and requires no manual pane management. Users can simply launch the layout script and have the dashboard automatically displayed alongside their work panes.

## Implementation Details

### Technical Approach

1. Create Zellij layout files (KDL format) with various dashboard configurations
2. Create shell script wrapper for easy layout startup
3. Support multiple pane size presets (1-line, 2-line, 3-line, detailed)
4. Provide installation and usage documentation
5. Handle graceful startup when daemon is not running (auto-start will handle it)
6. Place dashboard pane at top or bottom based on layout variant

### Files to Create

- `scripts/zellij/layouts/claude-minimal.kdl` - 1-line dashboard layout
- `scripts/zellij/layouts/claude-default.kdl` - 2-line dashboard layout
- `scripts/zellij/layouts/claude-detailed.kdl` - 3-line+ dashboard layout
- `scripts/zellij/zellij-claude.sh` - Shell script launcher
- `docs/integrations/zellij.md` - User documentation for Zellij integration

### Files to Modify

- `README.md` - Add Zellij integration section (optional)

### Dependencies

- S004.01: TUI must exist to display in pane
- S005.05: Layout presets (one-line, two-line, etc.) must be implemented

## Acceptance Criteria

- [ ] Given user runs `./scripts/zellij/zellij-claude.sh`, then Zellij session starts with dashboard pane visible
- [ ] Given 1-line layout selected, then dashboard pane is 1-2 rows tall showing session names and status
- [ ] Given 2-line layout selected, then dashboard pane is 2-3 rows tall showing status and working directory
- [ ] Given detailed layout selected, then dashboard pane is 4-6 rows tall showing full session details
- [ ] Given daemon is not running, then auto-start launches daemon and dashboard shows data
- [ ] Given user closes dashboard pane, then other panes continue functioning
- [ ] Given Zellij not installed, then script shows clear error with installation link
- [ ] Given layout files copied to `~/.config/zellij/layouts/`, then user can launch via `zellij --layout claude-default`

## Testing Requirements

- [ ] Manual test: Layout loads correctly with dashboard visible
- [ ] Manual test: Dashboard displays session data from daemon
- [ ] Manual test: Each layout size (minimal, default, detailed) renders correctly
- [ ] Manual test: Pane resize works without breaking dashboard
- [ ] Manual test: Works on macOS and Linux
- [ ] Manual test: Error message when Zellij not installed

## Out of Scope

- Native Zellij WASM plugin (deferred to v2+ per Q8)
- Automatic pane focus management
- Zellij session persistence across restarts
- tmux or other multiplexer support
- Session resurrection (separate story: S010.03)

## Notes

### Zellij Layout Examples

**Minimal (1-line):**

```kdl
layout {
    pane size=2 {
        command "agent-console"
        args "tui" "--layout" "one-line"
    }
    pane
}
```

**Default (2-line):**

```kdl
layout {
    pane size=3 {
        command "agent-console"
        args "tui" "--layout" "two-line"
    }
    pane split_direction="vertical" {
        pane
        pane
    }
}
```

**Detailed:**

```kdl
layout {
    pane size=5 {
        command "agent-console"
        args "tui"
    }
    pane
}
```

### Shell Script Launcher

```bash
#!/bin/bash
# scripts/zellij/zellij-claude.sh

if ! command -v zellij &> /dev/null; then
    echo "Error: Zellij not installed. See https://zellij.dev/documentation/installation"
    exit 1
fi

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LAYOUT="${1:-default}"

case "$LAYOUT" in
    "minimal"|"1")
        LAYOUT_FILE="$SCRIPT_DIR/layouts/claude-minimal.kdl"
        ;;
    "default"|"2")
        LAYOUT_FILE="$SCRIPT_DIR/layouts/claude-default.kdl"
        ;;
    "detailed"|"3")
        LAYOUT_FILE="$SCRIPT_DIR/layouts/claude-detailed.kdl"
        ;;
    *)
        echo "Usage: $0 [minimal|default|detailed]"
        exit 1
        ;;
esac

zellij --layout "$LAYOUT_FILE"
```

### Installation Instructions

Users can use layouts directly or install them to Zellij config:

```bash
# Option 1: Use directly
./scripts/zellij/zellij-claude.sh default

# Option 2: Install to Zellij config
mkdir -p ~/.config/zellij/layouts
cp scripts/zellij/layouts/claude-*.kdl ~/.config/zellij/layouts/
zellij --layout claude-default
```

### Pane Size Recommendations

| Layout Preset | Pane Height | Content |
|---------------|-------------|---------|
| minimal       | 1-2 rows    | Session names + status indicators |
| default       | 2-3 rows    | Status + working directory |
| detailed      | 4-6 rows    | Full status, directory, timestamps |

### Daemon Auto-Start

The dashboard will trigger daemon auto-start (S001.04) when it launches. No special handling needed in the layout file - the TUI client handles connection and auto-start automatically.

### Zellij Environment Detection

Scripts should detect if already inside Zellij to avoid nested sessions:

```bash
if [ -n "$ZELLIJ" ]; then
    echo "Already inside Zellij session."
    echo "Use 'zellij action new-pane' to add dashboard to current session."
    exit 1
fi
```
