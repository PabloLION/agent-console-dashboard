# Integrations

## Philosophy

ACD integrates with external tools through hooks -- event-driven,
fire-and-forget callbacks that push state into the daemon. The daemon is the
hub; hooks and TUIs are stateless clients. This push model means ACD never polls
agents for state and carries no coupling to any specific tool beyond the hook
contract.

Multiplexer-agnostic by design. Zellij is the primary target because the author
uses it, but the architecture assumes nothing about the hosting environment.
Tmux, Wezterm, bare terminals, and future multiplexers all work through the same
daemon socket.

## Claude Code Integration

Claude Code is the primary (and currently only) agent integration. ACD connects
to it through hook events -- shell commands that Claude Code invokes at
lifecycle points.

Six hooks are registered, covering the full session lifecycle:

| Hook event                            | Status mapped | Fires when                 |
| ------------------------------------- | ------------- | -------------------------- |
| `SessionStart`                        | `attention`   | Session begins or resumes  |
| `UserPromptSubmit`                    | `working`     | User sends a prompt        |
| `Stop`                                | `attention`   | Claude finishes responding |
| `SessionEnd`                          | `closed`      | Session ends               |
| `Notification` (`elicitation_dialog`) | `question`    | AskUserQuestion dialog     |
| `Notification` (`permission_prompt`)  | `attention`   | Permission prompt          |

All hooks invoke `acd claude-hook <status>`, which reads JSON from stdin
(session ID and working directory), forwards state to the daemon, and exits. The
daemon lazy-starts on the first hook event if not already running.

Two installation paths exist:

- `acd install` -- writes hooks to `~/.claude/settings.json` (personal use,
  works today)
- Plugin system -- `.claude-plugin/plugin.json` generated by `build.rs`
  (distribution path, strategy TBD per acd-qk2)

See [hooks architecture](../architecture/hooks.md) for the plugin manifest
format, stdin schema, and exit code contract.

## Terminal Multiplexer Support

### Zellij (primary)

Zellij is the reference multiplexer. ACD ships a layout file and launcher script
that start the dashboard in a dedicated pane alongside Claude Code sessions.
Session resurrection opens a new pane with `claude --resume`.

Implementation tracked in [acd-7u2](../../.beads/issues/acd-7u2.md).

### Tmux (future)

Tmux integration follows the same daemon-client model. A status bar widget
reading from `acd` is the likely first step. A native tmux plugin is deferred to
on-request only.

### Others

Wezterm, Screen, Byobu, and bare terminals all work because the integration
surface is the daemon socket, not the multiplexer. Any environment that can run
a shell command can fire hooks; any environment that can run a binary can
display the TUI.

## API Integration

ACD displays Anthropic API usage data (token consumption, rate limits) alongside
session status. The `claude-usage` crate fetches usage from the Anthropic API.

Design constraints:

- The daemon fetches usage centrally and broadcasts to connected TUIs -- no
  per-client API calls
- Credentials are accessed via macOS Keychain (primary) or Linux file fallback
- Fetch interval is configurable but not yet wired to the daemon timer (acd-j4u)

See [Keychain access method decision](../decisions/keychain-access-method.md)
for why we use `/usr/bin/security` CLI instead of `security-framework` crate.

## Deferred Integrations

Items intentionally deferred, not forgotten. Each has a tracking issue or
decision record.

| Integration          | Status            | Rationale                                        |
| -------------------- | ----------------- | ------------------------------------------------ |
| Zellij native plugin | Evaluate after v1 | WASM plugin adds complexity; layout works today  |
| Tmux native plugin   | On request only   | No demand yet; status bar widget suffices        |
| Multi-agent support  | v1+               | Architecture supports it; no second agent exists |
| Plugin distribution  | Decision pending  | `acd install` works; marketplace path unclear    |
| Windows named pipes  | v2+               | Unix socket only in v0                           |

See [integration plans](../archive/planning/5-integrations.md) for the original
planning notes and [project status](../project-status.md) for the current
deferred items list.
