# Story: Document Manual Service Setup

**Story ID:** S013.04 **Epic:**
[E013 - Deployment Infrastructure](../epic/E013-deployment-infrastructure.md)
**Status:** Draft **Priority:** P3 **Estimated Points:** 1

## Description

As a user who prefers manual control, I want documentation explaining how to set
up the daemon as a system service by hand, So that I can customize the service
configuration or troubleshoot issues with the automated install.

## Context

Some users prefer to manage service files manually rather than using
`acd service install`. This story provides documentation covering both macOS
(launchd) and Linux (systemd) manual setup, including XDG directory creation,
common troubleshooting steps, and log file locations.

## Implementation Details

### Technical Approach

1. Write a markdown guide covering manual setup for both platforms
2. Include copy-paste commands for each step
3. Document XDG State Directory setup for log files
4. Document common issues and troubleshooting
5. Reference the plist and unit file created in S013.01/S013.02

### Documentation Outline

The guide should cover:

- **macOS launchd setup** - manual plist installation and loading
- **Linux systemd setup** - manual unit file installation and enabling
- **XDG directories** - creating `~/.local/state/agent-console/` for logs
- **Verification** - confirming the service is running
- **Troubleshooting** - common issues and solutions

### Files Created

- `docs/guides/manual-service-setup.md` - manual setup documentation

### Dependencies

- [S013.01 - macOS launchd Plist](./S013.01-macos-launchd-plist.md) - Plist
  file to reference
- [S013.02 - Linux systemd Unit File](./S013.02-linux-systemd-unit-file.md) -
  Unit file to reference

## Acceptance Criteria

- [ ] Documentation covers macOS launchd manual setup with copy-paste commands
- [ ] Documentation covers Linux systemd manual setup with copy-paste commands
- [ ] XDG State Directory creation documented for both platforms
- [ ] Each step includes shell commands ready to copy-paste
- [ ] Troubleshooting section covers common issues (permission errors, path
      issues, service won't start)
- [ ] Links to service files in the repository
- [ ] Binary installation instructions cover both `cargo install` and manual
      build approaches
- [ ] Log file locations documented (`~/.local/state/agent-console/acd.log`)

## Testing Requirements

- [ ] Manual test: follow macOS instructions from scratch on clean system
- [ ] Manual test: follow Linux instructions from scratch on clean system
- [ ] Peer review of documentation clarity
- [ ] Verify all shell commands work as written

## Out of Scope

- Windows service setup
- Docker/container deployment
- Automated testing of documentation steps
- Video tutorials or screenshots

## Notes

### Example Structure

The documentation should follow this structure:

```markdown
# Manual Service Setup

## macOS (launchd)

### Prerequisites
- acd binary installed at /usr/local/bin/acd
- Log directory: mkdir -p ~/.local/state/agent-console

### Installation Steps
1. Copy plist to LaunchAgents directory
2. Load the service
3. Verify it's running

### Troubleshooting
...

## Linux (systemd)

### Prerequisites
...

### Installation Steps
...

### Troubleshooting
...
```

### Troubleshooting Topics

Common issues to document:

- **Permission denied** - log directory doesn't exist or wrong permissions
- **Service fails to start** - binary not found, socket path issues
- **Service not running after reboot** - not enabled for auto-start
- **Log file not created** - XDG directory missing, daemon not writing logs

### XDG Directory Setup

Document the manual creation of XDG directories:

```bash
# Create XDG State Directory for logs
mkdir -p ~/.local/state/agent-console
chmod 700 ~/.local/state/agent-console
```

> **Note:** The daemon creates the log directory automatically on startup (per
> S012.01). Manual creation is only needed for troubleshooting.

This ensures users understand where logs are stored and how to set up the
directory structure manually.

### Verification Commands

Document how to verify the service is running:

**macOS:**

```bash
# Check if service is loaded
launchctl list | grep com.agent-console

# View recent logs
tail -f ~/.local/state/agent-console/acd.log
```

**Linux:**

```bash
# Check service status
systemctl --user status acd

# View logs from journal
journalctl --user -u acd -f

# View log file
tail -f ~/.local/state/agent-console/acd.log
```

### Binary Installation

The documentation must include binary installation instructions:

**Primary (cargo install):**

```bash
cargo install agent-console-dashboard
# Installs to ~/.cargo/bin/acd
```

**Alternative (manual build):**

```bash
cargo build --release
cp target/release/acd /usr/local/bin/
```

Both approaches result in the `acd` binary being available on `$PATH`, which is
a prerequisite for the service files.

### Relationship to CLI Commands

The documentation should mention that `acd service install` automates these
manual steps, but manual setup provides more control and troubleshooting
visibility.
